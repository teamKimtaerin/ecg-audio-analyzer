# ğŸµ ECG Audio Analyzer ML Server

> WhisperX ê¸°ë°˜ ê³ ì„±ëŠ¥ ìŒì„± ë¶„ì„ ë° í™”ì ë¶„ë¦¬ ML ì„œë²„

<br/>

## ğŸ”— ë°”ë¡œê°€ê¸°

- **API ì„œë²„**: `http://localhost:8080`
- **Health Check**: `http://localhost:8080/health`
- **API ë¬¸ì„œ**: `http://localhost:8080/docs` (FastAPI ìë™ ë¬¸ì„œ)

<br/>

## ğŸ“– ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
2. [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
3. [ê¸°ìˆ  ìŠ¤íƒ](#ï¸-ê¸°ìˆ -ìŠ¤íƒ)
4. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ï¸-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
5. [ì„¤ì¹˜ ë° ì‹¤í–‰](#-ì„¤ì¹˜-ë°-ì‹¤í–‰)
6. [API ì‚¬ìš©ë²•](#-api-ì‚¬ìš©ë²•)

<br/>

## ğŸ“Œ í”„ë¡œì íŠ¸ ì†Œê°œ

### ğŸ¤” ê°œë°œ ë°°ê²½
- ì˜ìƒ ì½˜í…ì¸ ì—ì„œ **ì •í™•í•œ ìŒì„± ì¸ì‹**ê³¼ **í™”ì êµ¬ë¶„**ì´ í•„ìš”í•œ ìƒí™©ì´ ì¦ê°€
- ê¸°ì¡´ ì†”ë£¨ì…˜ë“¤ì˜ **ì²˜ë¦¬ ì†ë„**ì™€ **ì •í™•ë„** í•œê³„
- **ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì¶”ì **ê³¼ **GPU ìµœì í™”**ê°€ ê°€ëŠ¥í•œ ê³ ì„±ëŠ¥ ì„œë²„ í•„ìš”

### ğŸ’¡ ì„œë¹„ìŠ¤ ëª©í‘œ
- **WhisperX** ê¸°ë°˜ ê³ ì •í™•ë„ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜
- **Pyannote.audio** í™œìš© ì •ë°€í•œ í™”ì ë¶„ë¦¬
- **ì‹¤ì‹œê°„ ìŒí–¥ íŠ¹ì„± ë¶„ì„** (í”¼ì¹˜, ë³¼ë¥¨, ìŠ¤í™íŠ¸ëŸ´ íŠ¹ì„±)
- **AWS GPU ì¸ìŠ¤í„´ìŠ¤** ìµœì í™”ë¡œ 10ë¶„ ì˜ìƒì„ 30ì´ˆ ë‚´ ì²˜ë¦¬

<br/>

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1. ğŸ™ï¸ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜ (STT)
- **WhisperX large-v2** ëª¨ë¸ ì‚¬ìš©ìœ¼ë¡œ ë†’ì€ ì •í™•ë„
- **ë‹¤êµ­ì–´ ì§€ì›** (ìë™ ê°ì§€ ë˜ëŠ” ì–¸ì–´ ì§€ì •)
- **ë‹¨ì–´ ë‹¨ìœ„ íƒ€ì„ìŠ¤íƒ¬í”„** ì •í™•í•œ ë™ê¸°í™”

### 2. ğŸ‘¥ í™”ì ë¶„ë¦¬ (Speaker Diarization)
- **Pyannote.audio 3.1** ê¸°ë°˜ ê³ ì •í™•ë„ í™”ì êµ¬ë¶„
- **ë‹¤ì¤‘ í™”ì ë™ì‹œ ì²˜ë¦¬** ê°€ëŠ¥
- ê° ì„¸ê·¸ë¨¼íŠ¸ë³„ **í™”ì ID ìë™ í• ë‹¹**
- í™”ìë³„ **ì „ì²´ ë°œí™” ì‹œê°„ í†µê³„** ì œê³µ

### 3. ğŸµ ìŒí–¥ íŠ¹ì„± ë¶„ì„
- **MFCC** (Mel-frequency cepstral coefficients)
- **í”¼ì¹˜ ë¶„ì„** (Pitch/F0 detection)
- **ë³¼ë¥¨ ë¶„ì„** (RMS, dB level)
- **ìŠ¤í™íŠ¸ëŸ´ íŠ¹ì„±** (Spectral centroid, rolloff)

### 4. ğŸ“Š ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì½œë°±
- **ë¹„ë™ê¸° ì²˜ë¦¬**ë¡œ ê¸´ ì˜ìƒë„ ì•ˆì •ì  ì²˜ë¦¬
- **ì‹¤ì‹œê°„ ì§„í–‰ë¥ ** (0-100%) ë° ìƒíƒœ ë©”ì‹œì§€
- **ì—ëŸ¬ í•¸ë“¤ë§**ê³¼ ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜
- **RESTful ì½œë°±**ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì—°ë™

<br/>

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
| --- | --- |
| **ML í”„ë ˆì„ì›Œí¬** | `PyTorch 1.13+` `WhisperX` `Pyannote.audio` `Librosa` |
| **API ì„œë²„** | `FastAPI` `Uvicorn` `Pydantic` `AsyncIO` |
| **GPU ìµœì í™”** | `CUDA 11.7+` `cuDNN` `TensorRT` `Mixed Precision` |
| **í´ë¼ìš°ë“œ ì¸í”„ë¼** | `AWS EC2 (T4 GPU)` `S3` `Docker` |


<br/>

## âš™ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 
â”‚   í´ë¼ì´ì–¸íŠ¸       â”‚â”€â”€â”€â–¶â”‚   FastAPI ì„œë²„    â”‚
â”‚   (Backend)     â”‚    â”‚  (ml_api_server) â”‚    
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   ì½œë°± ì‹œìŠ¤í…œ       â”‚
                     â”‚ (Progress Track) â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ML ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì˜¤ë””ì˜¤ ì¶”ì¶œ       â”‚  ìŒì„± ì¸ì‹     â”‚   í™”ì ë¶„ë¦¬     â”‚  íŠ¹ì„± ë¶„ì„        â”‚
â”‚ (AudioExtractor)â”‚ (WhisperX)   â”‚ (Pyannote)    â”‚ (Acoustic)     â”‚
â”‚                 â”‚              â”‚               â”‚                â”‚
â”‚ â€¢ MP4â†’WAV ë³€í™˜   â”‚ â€¢ STT ì²˜ë¦¬    â”‚ â€¢ í™”ì êµ¬ë¶„     â”‚ â€¢ MFCC         â”‚
â”‚ â€¢ S3/URL ì§€ì›    â”‚ â€¢ íƒ€ì„ìŠ¤íƒ¬í”„    â”‚ â€¢ ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•   â”‚ â€¢ Pitch        â”‚
â”‚ â€¢ GPU ê°€ì†       â”‚ â€¢ ë‹¤êµ­ì–´ ì§€ì›   â”‚ â€¢ í™”ì í†µê³„     â”‚ â€¢ Volume       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ê²°ê³¼ JSON ìƒì„±       â”‚
                    â”‚ â€¢ ì„¸ê·¸ë¨¼íŠ¸ ì •ë³´           â”‚
                    â”‚ â€¢ í™”ì ë§¤í•‘              â”‚
                    â”‚ â€¢ ìŒí–¥ íŠ¹ì„±              â”‚
                    â”‚ â€¢ ë©”íƒ€ë°ì´í„°              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

- **`ml_api_server.py`** - FastAPI ê¸°ë°˜ ë©”ì¸ ì„œë²„
- **`src/pipeline/manager.py`** - ì „ì²´ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ê´€ë¦¬
- **`src/models/speech_recognizer.py`** - WhisperX ìŒì„± ì¸ì‹
- **`src/services/audio_extractor.py`** - ì˜¤ë””ì˜¤ ì¶”ì¶œ ë° ì „ì²˜ë¦¬
- **`src/services/acoustic_analyzer.py`** - ìŒí–¥ íŠ¹ì„± ë¶„ì„
- **`src/utils/gpu_optimizer.py`** - GPU ë©”ëª¨ë¦¬ ìµœì í™”

<br/>

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- **Python 3.7 ì´ìƒ** (3.10+ ê¶Œì¥)
- **NVIDIA GPU** (T4, V100 ë“±) + CUDA 11.7+
- **FFmpeg** ì„¤ì¹˜ í•„ìˆ˜
- **8GB+ GPU ë©”ëª¨ë¦¬** ê¶Œì¥

### 2. ì„¤ì¹˜ ê³¼ì •

```bash
# 1. Repository í´ë¡ 
git clone [ì €ì¥ì†Œ ì£¼ì†Œ]
cd ecg-audio-analyzer

# 2. Python ê°€ìƒí™˜ê²½ ìƒì„± (ê¶Œì¥)
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 3. ê¸°ë³¸ ì˜ì¡´ì„± ì„¤ì¹˜
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt

# 4. WhisperX ì„¤ì¹˜ (GitHubì—ì„œ ì§ì ‘)
pip install git+https://github.com/m-bain/whisperx.git@v3.1.1

# 5. GPU í™˜ê²½ í™•ì¸
python -c "import torch; print(f'CUDA available: {torch.cuda.is_available()}')"
```

### 3. ì„œë²„ ì‹¤í–‰

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
python ml_api_server.py --log-level debug

# í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰
python ml_api_server.py --host 0.0.0.0 --port 8080

# Docker ì‹¤í–‰ (GPU ì§€ì›)
docker build -t ecg-analyzer .
docker run --gpus all -p 8080:8080 -v $(pwd)/output:/app/output ecg-analyzer
```

<br/>

## ğŸ“¡ API ì‚¬ìš©ë²•

### 1. ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/health` | ì„œë²„ ìƒíƒœ í™•ì¸ |
| `POST` | `/transcribe` | ìŒì„± ë¶„ì„ (ë™ê¸°) |
| `POST` | `/api/upload-video/process-video` | ìŒì„± ë¶„ì„ (ë¹„ë™ê¸° + ì½œë°±) |
| `GET` | `/jobs/{job_id}` | ì‘ì—… ìƒíƒœ ì¡°íšŒ |

### 2. ìŒì„± ë¶„ì„ API

**POST `/transcribe`**

```bash
# S3 íŒŒì¼ ë¶„ì„
curl -X POST "http://localhost:8080/transcribe" \
  -H "Content-Type: application/json" \
  -d '{
    "video_path": "s3://bucket-name/video.mp4",
    "language": "en",
    "job_id": "task-123"
  }'
```

**ìš”ì²­ íŒŒë¼ë¯¸í„°:**
```json
{
  "video_path": "string",      // í•„ìˆ˜: íŒŒì¼ ê²½ë¡œ ë˜ëŠ” URL
  "audio_path": "string",      // ì„ íƒ: ì˜¤ë””ì˜¤ íŒŒì¼ ì§ì ‘ ì§€ì •
  "language": "string",        // ì„ íƒ: ì–¸ì–´ ì½”ë“œ (ê¸°ë³¸ê°’: "auto")
  "job_id": "string"          // ì„ íƒ: ì‘ì—… ID (ì½œë°±ìš©)
}
```

### 3. ì‘ë‹µ ë°ì´í„° êµ¬ì¡°

```json
{
  "segments": [
    {
      "start_time": 0.0,
      "end_time": 5.23,
      "speaker": {
        "speaker_id": "SPEAKER_00"
      },
      "text": "ì•ˆë…•í•˜ì„¸ìš”, ë°˜ê°‘ìŠµë‹ˆë‹¤.",
      "words": [
        {
          "word": "ì•ˆë…•í•˜ì„¸ìš”",
          "start": 0.12,
          "end": 1.45,
          "acoustic_features": {
            "volume_db": -18.5,
            "pitch_hz": 145.2,
            "spectral_centroid": 1250.4
          }
        }
      ]
    }
  ],
  "speakers": {
    "SPEAKER_00": {
      "total_duration": 45.67
    },
    "SPEAKER_01": {
      "total_duration": 23.12
    }
  },
  "text": "ì „ì²´ í…ìŠ¤íŠ¸ ë‚´ìš©...",
  "language": "ko",
  "duration": 68.79,
  "metadata": {
    "processing_time": 12.34,
    "model_versions": {
      "whisperx": "large-v2",
      "diarization": "pyannote/speaker-diarization-3.1"
    }
  }
}
```

### 4. ë¹„ë™ê¸° ì²˜ë¦¬ ë° ì½œë°±

**POST `/api/upload-video/process-video`**

- ê¸´ ì˜ìƒ ì²˜ë¦¬ìš© ë¹„ë™ê¸° API
- ì‹¤ì‹œê°„ ì§„í–‰ë¥ ì„ ì½œë°±ìœ¼ë¡œ ì „ì†¡
- ì‘ì—… ì™„ë£Œ í›„ ìµœì¢… ê²°ê³¼ ì½œë°±

**ì§„í–‰ë¥  ì½œë°± ì˜ˆì œ:**
```json
{
  "job_id": "task-123",
  "status": "processing",
  "progress": 65,
  "message": "í™”ì ë¶„ë¦¬ ì§„í–‰ ì¤‘...",
  "result": null
}
```

**ì™„ë£Œ ì½œë°± ì˜ˆì œ:**
```json
{
  "job_id": "task-123",
  "status": "completed",
  "progress": 100,
  "message": "ë¶„ì„ ì™„ë£Œ",
  "result": { /* ìœ„ì˜ ì‘ë‹µ ë°ì´í„° êµ¬ì¡° */ }
}
```

<br/>
